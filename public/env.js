let arr = []
let index

//function to swipe the picture
//swipe left means like right means not
const swipe = (matchArray, arr) => {
    let container = document.querySelector('#match');
    let listener = SwipeListener(container);

    container.addEventListener('swipe', function (e) {
        var directions = e.detail.directions;
        //if swipe left record the person and display the next person
        if (directions.left) {


            //get the value of the current person that show to the user
            let searchTerm = $('#name').html();
            $('#matchList').append('<a href="#!" class="collection-item">' + searchTerm + '</a>');

            //get to the next person index
            matchArray.forEach((person, i) => {
                if (person.name == searchTerm) {
                    index = i + 1
                    matchSideBySide(person)

                }

            });

            console.log(index);
            //if the last person 
            if (index == matchArray.length) {
                listener.off();
                arr.push(searchTerm);
                console.log('end');
                $('#match').hide()
                $('#personDetail').hide()
                $('#introduction').hide()


                let result = arr.join(' and ')
                $('#result').html('You are matched with ' + result)
                console.log(arr);

            } else {
                //if not the last person
                let name = matchArray[index].name;
                let age = matchArray[index].age;
                $('#name').html(name)
                $('#age').html(age)
                $('#match').attr('style', 'background-image: url("assets/image' + (index + 1) + '.jfif")')
                arr.push(searchTerm);
                console.log(arr);
            }
        }


        //swipe right just display the next person
        if (directions.right) {
            let searchTerm = $('#name').html();

            matchArray.forEach((person, i) => {
                if (person.name == searchTerm) {
                    index = i + 1
                }

            });

            console.log(index);
            if (index == matchArray.length) {
                listener.off();
                console.log('end');
                $('#match').hide()
                $('#personDetail').hide()
                $('#introduction').hide()
                if (!arr[0]) {
                    $('#result').html('Sorry there are no more matches now')

                } else {
                    let result = arr.join(' and ')
                    $('#result').html('You are matched with ' + result)

                }
            } else {

                let name = matchArray[index].name;
                let age = matchArray[index].age;
                $('#name').html(name)
                $('#age').html(age)
                $('#match').attr('style', 'background-image: url("assets/image' + (index + 1) + '.jfif")')

                console.log(arr);
            }
        }


    });
}
//when match popup a modal side by side 
const matchSideBySide = (person) => {
    let modal = document.querySelector('#matchModal');
    let modalInstance = M.Modal.init(modal);
    modalInstance.open();
    $("#matchModalBtn").click(function () {
        modalInstance.close()
    });
    let image = person.pic;
    let name = person.name;
    $('#matchImage').attr('src', image)
    $('#matchMessage').html('You are matched with ' + name)


}
// the mock data
//all the pictures are from https://thispersondoesnotexist.com/ which is generated by AI
let profileArray = [{
        name: 'bob',
        age: 23,
        pic: 'assets/image1.jfif'
    },
    {
        name: 'Linda',
        age: 25,
        pic: 'assets/image2.jfif'
    },
    {
        name: 'Susan',
        age: 48,
        pic: 'assets/image3.jfif'
    },
    {
        name: 'Helen',
        age: 21,
        pic: 'assets/image4.jfif'
    },
    {
        name: 'Daniel',
        age: 32,
        pic: 'assets/image5.jfif'
    }
]

//The modal function, get the user profile and then display to the user card
const createProfile = () => {
    let firstName = $('#first_name').val();
    let lastName = $('#last_name').val();
    let age = parseInt($('#userAge').val())
    let gender = $('#gender').val();
    console.log(firstName);
    console.log(lastName);
    console.log(age);
    console.log(gender);
    $('#profile').append('<div class="col s6 push-s1">' + 'firstname: ' + firstName + '</div>')
    $('#profile').append('<div class="col s6 push-s5">' + 'lastname: ' + lastName + '</div>')
    $('#profile').append('<div class="col s6 push-s1">' + 'age: ' + age + '</div>')
    $('#profile').append('<div class="col s6 push-s5">' + 'gender: ' + gender + '</div>')

    $('#userCard').attr('style', 'visibility: show')
    $('#loginBtn').attr('style', 'visibility: hidden')
    $('#loginInfo').attr('style', 'visibility: hidden')
    $('#container').attr('style', 'visibility: show')
    $('#introduction').attr('style', 'visibility:show')
}

$(document).ready(function () {
    //display the first person at the start
    $('#name').html(profileArray[0].name)
    $('#age').html(profileArray[0].age)
    //I am using background image instead of add an image element into div 
    //because this can make the image not draggable so make user easy to swipe
    $('#match').attr('style', 'background-image: url("assets/image1.jfif")')
    swipe(profileArray, arr)



    //initializes the modal window 
    $('.modal').modal();

})